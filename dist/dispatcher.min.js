var Dispatcher=Class.extend({_routes:{},_required:{},init:function(a,b){a&&(this._routes=a),b&&(this._required=b);var c=this;$(document).on("pjax:end",function(a,b,d){c._handleRoute(d.url)}),this._handleRoute(window.location)},route:function(a,b,c){this._routes[a]=function(){new b,b[c]()}},before:function(a,b){this._required[a]=b},getLocation:function(a){var b=document.createElement("a");return b.href=a,b},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)},_handleRoute:function(a){var b=this,c=b.getLocation(a);if(b._routes.hasOwnProperty(c.pathname))this._dispatchPath(c.pathname);else{var d,e,f,g;if(-1!=c.pathname.indexOf("/")?(d=c.pathname.split("/"),""===d[0]?(g="/"+d[1]+"/",e=window[d[1]]):(g="/"+d[0]+"/",e=window[d[0]]),d.length>=2&&""!==d[2]&&(g="/"+d[1]+"/"+d[2]+"/",f=d[2])):g="/",b._routes.hasOwnProperty(g))this._dispatchPath(g);else if(g="/"+d[1]+"/*",b._routes.hasOwnProperty(g))this._dispatchPath(g);else if(e&&"undefined"!=typeof e){var h=new e;f&&h[f]()}}},_dispatchPath:function(a){var b,c,d=this;if(d._required.hasOwnProperty(a)){var e=function(){d.isFunction(d._routes[a])?d._routes[a]():"undefined"!=d._routes[a].controller&&(b=window[d._routes[a].controller],b&&"undefined"!=typeof b&&(c=new b,"undefined"!=d._routes[a].action&&c[d._routes[a].action]()))};this._loadRequiredFiles(d._required[a],e)}else d.isFunction(d._routes[a])?d._routes[a]():"undefined"!=d._routes[a].controller&&(b=window[d._routes[a].controller],b&&"undefined"!=typeof b&&(c=new b,"undefined"!=d._routes[a].action&&c[d._routes[a].action]()))},_loadRequiredFiles:function(a,b){var c=this;a.css.length?this.loadStyleSheet(a.css.shift(),function(){a.css.length||c._loadRequiredFiles(a,b)}):a.js.length?this.loadJavascript(a.js.shift(),function(){a.js.length?b():c._loadRequiredFiles(a,b)}):b()},loadStyleSheet:function(a,b,c){var d=document.getElementsByTagName("head")[0],e=document.createElement("link");e.setAttribute("href",a),e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css");var f,g;"sheet"in e?(f="sheet",g="cssRules"):(f="styleSheet",g="rules");var h=setInterval(function(){try{e[f]&&e[f][g].length&&(clearInterval(h),clearTimeout(i),b.call(c||window,!0,e))}catch(a){}finally{}},10),i=setTimeout(function(){clearInterval(h),clearTimeout(i),d.removeChild(e),b.call(c||window,!1,e)},15e3);return d.appendChild(e),e},loadJavascript:function(a,b){var c,d=document.createElement("script");d.setAttribute("src",a),b&&(d.onreadystatechange=d.onload=function(){c||b(),c=!0}),document.getElementsByTagName("head")[0].appendChild(d)}});